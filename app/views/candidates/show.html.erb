
<div class="container">
  <div class="row hidden-sm hidden-md hidden-lg">
    <div class="status-desc-xs status"><%= @candidate.status.description %></div>
    <% if !@candidate.picture.attachment.nil? %>
      <%= image_tag @candidate.picture, class:"show-photo-xs" %>
    <% else %>
      <%= image_tag "empty_photo.jpg", class:"show-photo-xs" %>
    <% end %>
    <div class="text-cand-xs" >
      <div><strong>Election <%= @candidate.election.name %> du <%= @candidate.election.election_date %></strong></div>
      <div><strong><%= @candidate.district %></strong></div>
      <div>Prénom: <%= @candidate.user.first_name %> <%= @candidate.user.last_name %></div>
      <div>Profession: <%= @candidate.profession %></div>
      <div>Courriel: <%= @candidate.user.email %></div>
      <div>Mandat: <%= @candidate.mandate %></div>
      <div><strong>Suppléant:</strong></div>
      <% unless @candidate.deputy.nil? %>
        <div>Prénom: <%= @candidate.deputy.first_name %> <%= @candidate.deputy.last_name %></div>
        <div>Nom: <%= @candidate.deputy.profession %></div>
      <% end %>
   </div>
   <div class="button-xs">
    <% if @candidate.status.code == 'OPEN' %>
      <%= link_to "#{@candidate.status.next_action}", validate_candidate_path(@candidate), class: "btn btn-success but-xs" %>
      <%= link_to 'Modifier candidature', edit_candidate_path(@candidate), class: "btn btn-primary but-xs" %>
    <% elsif @candidate.status.code == 'PENDING_SD' && (current_user.role.code == 'DNF' || current_user.role.code == 'SD' || current_user.role.code == 'COM')%>  
      <%= link_to "#{@candidate.status.next_action}", validate_candidate_path(@candidate), class: "btn btn-success but-xs" %>
      <%= link_to "Refuser candidature", reject_candidate_path(@candidate), class: "btn btn-warning but-xs" %>
      <%= link_to 'Modifier candidature', edit_candidate_path(@candidate), class: "btn btn-primary but-xs" %>
    <% elsif @candidate.status.code == 'PENDING_DNF' && (current_user.role.code == 'DNF' || current_user.role.code == 'COM') %>
      <%= link_to "#{@candidate.status.next_action}", validate_candidate_path(@candidate), class: "btn btn-success but-xs" %>
      <%= link_to "Refuser candidature", reject_candidate_path(@candidate), class: "btn btn-warning but-xs" %>
      <%= link_to 'Modifier candidature', edit_candidate_path(@candidate), class: "btn btn-primary but-xs" %>
    <% elsif @candidate.status.code == 'PENDING_COM' && current_user.role.code == 'COM' %>
      <%= link_to "#{@candidate.status.next_action}", validate_candidate_path(@candidate), class: "btn btn-success but-xs" %>
      <%= link_to "Refuser candidature", reject_candidate_path(@candidate), class: "btn btn-warning but-xs" %>
      <%= link_to 'Modifier candidature', edit_candidate_path(@candidate), class: "btn btn-primary but-xs" %>
    <% elsif @candidate.status.code == 'PENDING_CANDIDATE' && current_user == @candidate.user %> 
      <%= link_to "#{@candidate.status.next_action}", validate_candidate_path(@candidate), class: "btn btn-success but-xs" %>
      <%= link_to "Refuser candidature", reject_candidate_path(@candidate), class: "btn btn-warning but-xs" %>
    <% end %>
  </div>   
  <div class="files-xs">
    <% if current_user.role.code == 'COM' && @candidate.status.order > 3%>
      <strong>Fichiers Indesign:</strong> <br/>
      <% if @candidate.documents.attached? %>
        <ul>
        <% @candidate.documents.each do |document| %>
          <li><%= link_to document.filename, document, target: '_blank' %>
          <% if current_user.role.code == 'COM'%>
            <%= link_to 'Supprimer', remove_attachment_candidate_path(@candidate, attachment: document.id, doc_type: 'documents'), method: :post, class: "btn btn-danger"%>
            </li>
          <% end %>   
        <% end %>
        </ul>
      <% end %>
      <%= simple_form_for @candidate, :url => attach_candidate_path, method: :post do |cand| %>
        <%= cand.file_field :documents, multiple: true %>
         <%= cand.hidden_field :doc_type, :value => 'documents' %>
        <%= cand.submit 'Valider' %>
      <% end %>
    <% end %>
    <br>
    <br>
    <% if @candidate.status.order > 4 %>
      <strong>Kit de campagne:</strong> 
      <ul>
      <% @candidate.kits.each do |kit| %>
        <%#= image_tag kit.preview(resize_to_limit: [100, 100]) if kit.previewable?%>
        <%#= image_tag kit.variant(resize_to_limit: [100, 100]) if ['image/jpeg', 'image/png'].include? kit.content_type%>
        <li><%= link_to kit.filename, kit, target: '_blank'%> 
        <% if current_user.role.code == 'COM'%>
          <%= link_to 'Supprimer', remove_attachment_candidate_path(@candidate, attachment: kit.id, doc_type: 'kits'), method: :post, class: "btn btn-danger"%>
        <% end %>
        </li>   
      <% end %>
      </ul>
        <%= simple_form_for @candidate, :url => attach_candidate_path, method: :post do |cand| %>
        <%= cand.file_field :kits, multiple: true %>
        <%= cand.hidden_field :doc_type, :value => 'kits' %>
        <%= cand.submit 'Valider' %>
      <% end %>
    <% end %>
  </div>
  <% if @candidate.audits.any? %>
  <div class="audit-xs">
    <strong>Audit:</strong>
    <% @candidate.audits.sort.reverse.each do |audit| %>
      <div class="audit-text-xs"><%= audit.validation_date.strftime("Validé le %d/%m/%Y à %I:%M%p")%> par <%= audit.user.first_name%> <%= audit.user.last_name%> (<%= audit.user.role.code %>)<br>
            Status: <%= audit.status.code %> <br>
      </div>
    <% end  %>
  </div>
  <% end %>
</div>
<%= javascript_pack_tag 'tuning' %>
